<!--pages/record/record.wxml-->
<view class="container">
  <!-- å›ºå®šé¡¶éƒ¨çš„å¯¼èˆªæ  + å†å²æˆ˜ç»© + æ•°æ®å¡ç‰‡ -->
  <view class="fixed-header">
    <!-- ä»…å±•ç¤ºæ ‡é¢˜çš„ navigation-bar ç»„ä»¶ -->
    <navigation-bar title="Identity V"></navigation-bar>

    <!-- ç‹¬ç«‹çš„å†å²æˆ˜ç»©æ  -->
    <view class="history-bar">
      <text class="history-title">å†å²æˆ˜ç»©</text>
      <view class="history-actions">
        <view class="action-btn refresh-btn" bindtap="onRefresh">
          <text class="icon">ğŸ”„</text>
        </view>
        <view class="action-btn add-btn" bindtap="onAdd">
          <text class="icon">+</text>
        </view>
      </view>
    </view>

    <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
    <view class="stats-card">
      <view class="stats-row">
        <text class="stats-label">ç›‘ç®¡è€…èƒœç‡ï¼š75.00%</text>
        <text class="stats-sub">å¸¸ç”¨è§’è‰²ï¼šæ‘„å½±å¸ˆ</text>
      </view>
      <view class="stats-row">
        <text class="stats-label">æ±‚ç”Ÿè€…èƒœç‡ï¼š100.00%</text>
        <text class="stats-sub">å¸¸ç”¨è§’è‰²ï¼šå¤è‘£å•†</text>
      </view>
      <!-- æ’è¡Œæ¦œæŒ‰é’® -->
      <view class="rank-btn" bindtap="onRankClick">
        <text class="rank-btn-text">æ’è¡Œæ¦œ</text>
      </view>
    </view>
  </view>

  <!-- å¯æ»‘åŠ¨çš„æˆ˜ç»©åˆ—è¡¨ï¼ˆç•™å‡ºé¡¶éƒ¨å›ºå®šåŒºåŸŸçš„é—´è·ï¼‰ -->
  <scroll-view class="record-list-container" scroll-y="true">
    <view class="record-list">
      <block wx:for="{{records}}" wx:key="index">
        <view class="record-item {{item.type}}"
        bindlongpress="onRecordLongPress" 
              data-index="{{index}}"  
              data-record="{{item}}">
          <!-- æˆ˜ç»©å¤´éƒ¨ -->
          <view class="record-header" bindtap="toggleExpand" data-index="{{index}}">
            <text class="record-role">{{item.role}}</text>
            <view class="header-right">
              <text class="record-result">{{item.result}}</text>
              <text class="expand-btn">{{item.expanded ? 'â–²' : 'â–¼'}}</text>
            </view>
          </view>

          <!-- æˆ˜ç»©è¯¦æƒ… -->
          <view class="record-detail" wx:if="{{item.expanded}}">
            <block wx:for="{{item.details}}" wx:for-item="detail" wx:key="detailKey">
              <view class="detail-item">
                <text class="detail-icon">{{detail.role.includes('ç›‘ç®¡') ? 'ğŸ‘ï¸' : 'ğŸ‘¤'}}</text>
                <text class="detail-text">{{detail.role}}</text>
                <text class="detail-tag {{detail.tag.includes('å…¨èƒœ') || detail.tag.includes('é€ƒè„±') ? 'win-tag' : 'lose-tag'}}">{{detail.tag}}</text>
              </view>
            </block>
          </view>
        </view>
      </block>
    </view>
  </scroll-view>

  <!-- æ–°å¢ï¼šè‡ªå®šä¹‰ä¿®æ”¹å¼¹çª—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
  <view class="edit-modal {{showEditModal ? 'show' : ''}}" wx:if="{{showEditModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ä¿®æ”¹</text>
        <view class="modal-close" bindtap="closeEditModal">âœ•</view>
      </view>

      <!-- ç›‘ç®¡è€…éƒ¨åˆ† -->
      <view class="modal-section">
        <text class="section-label">ç›‘ç®¡è€…ï¼š</text>
        <view class="tag-group">
          <view class="tag-item" bindtap="onSelectRole" data-type="killer" data-value="æ‘„å½±å¸ˆ">æ‘„å½±å¸ˆ</view>
        </view>
        <text class="section-sub">æºå¸¦å¤©èµ‹ï¼š</text>
        <view class="tag-group">
          <view class="tag-item" bindtap="onSelectTalent" data-type="killer" data-value="æŒ½ç•™">æŒ½ç•™</view>
          <view class="tag-item" bindtap="onSelectTalent" data-type="killer" data-value="ç¦é—­ç©ºé—´">ç¦é—­ç©ºé—´</view>
        </view>
      </view>

      <!-- æ±‚ç”Ÿè€…éƒ¨åˆ†ï¼ˆå¾ªç¯æ˜¾ç¤ºï¼‰ -->
      <view class="modal-section" wx:for="{{editDetails}}" wx:key="index">
        <text class="section-label">æ±‚ç”Ÿè€…ï¼š</text>
        <view class="tag-group">
          <view class="tag-item" bindtap="onSelectResult" data-index="{{index}}" data-value="è¿·å¤±">è¿·å¤±</view>
          <view class="tag-item" bindtap="onSelectSurvivor" data-index="{{index}}" data-value="{{item.survivor}}">{{item.survivor}}</view>
        </view>
        <text class="section-sub">æºå¸¦å¤©èµ‹ï¼š</text>
        <view class="tag-group">
          <view class="tag-item" bindtap="onSelectTalent" data-type="survivor" data-index="{{index}}" data-value="é£è½®æ•ˆåº”">é£è½®æ•ˆåº”</view>
          <view class="tag-item" bindtap="onSelectTalent" data-type="survivor" data-index="{{index}}" data-value="åŒ–é™©ä¸ºå¤·">åŒ–é™©ä¸ºå¤·</view>
        </view>
      </view>

      <view class="modal-actions">
        <view class="action-btn confirm" bindtap="confirmEdit">ç¡®è®¤</view>
        <view class="action-btn cancel" bindtap="closeEditModal">å–æ¶ˆ</view>
      </view>
    </view>
  </view>
</view>